version: '3.8'

services:
  codebeamer-mcp:
    build: .
    container_name: codebeamer-mcp-server
    ports:
      - "8080:8080"
    environment:
      # Required
      - CODEBEAMER_URL=${CODEBEAMER_URL:-https://your-codebeamer.com}
      - CODEBEAMER_API_KEY=${CODEBEAMER_API_KEY}

      # Transport (http for container deployment)
      - MCP_TRANSPORT=http
      - MCP_HOST=0.0.0.0
      - MCP_PORT=8080

      # SSL Configuration (set to false for self-signed certs)
      - CODEBEAMER_SSL_VERIFY=${CODEBEAMER_SSL_VERIFY:-true}

      # Optional tuning
      - CODEBEAMER_MAX_CALLS=${CODEBEAMER_MAX_CALLS:-60}
      - CODEBEAMER_CACHE_TTL=${CODEBEAMER_CACHE_TTL:-300}

    healthcheck:
      test: [ "CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8080/health')" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

    restart: unless-stopped
